{"version":3,"sources":["../src/validation-reporter.js"],"names":[],"mappings":"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","file":"validation-reporter.js","sourcesContent":["import figures from \"figures\";\nimport { colors, log } from \"gulp-util\";\n\nconst DEFAULT_OPTIONS = {\n  silent: false,\n  verbose: false,\n  missing: \"error\",\n  emitError: true,\n};\n\nexport default class ValidationReporter {\n  constructor(options) {\n    this.options = Object.assign({}, DEFAULT_OPTIONS, options);\n    this.summary = {\n      total: 0,\n      valid: 0,\n      invalid: 0,\n      errors: 0,\n      missing: 0,\n    };\n  }\n\n  reportFile(file, result) {\n    this.addResultToSummary(file, result);\n    if (this.options.silent) return;\n\n    if (this.isValidResult(result)) {\n      if (result.missing.length > 0 && this.options.missing === \"warn\") {\n        this.reportMissingsWarning(file, result.missing.length);\n        this.reportMissing(result.missing, true);\n      } else {\n        this.reportValid(file);\n      }\n    } else {\n      this.reportFailed(file, result.errors.length, result.missing.length);\n      if (result.errors.length > 0) {\n        this.reportErrors(result.errors);\n      }\n      if (result.missing.length > 0) {\n        this.reportMissing(result.missing, false);\n      }\n    }\n  }\n\n  reportSummary() {\n    if (this.options.silent) return;\n\n    if (this.summary.invalid > 0) {\n      log(\n        colors.red(\"Schema validation failed\"),\n        \"for\",\n        colors.red(this.summary.invalid), \"file(s)\",\n        \"/\",\n        colors.magenta(this.summary.total), \"file(s)\"\n      )\n    } else if (this.summary.valid > 0) {\n      log(\n        colors.green(\"Schema validation passed\"),\n        \"for\",\n        colors.green(this.summary.valid), \"file(s)\",\n        \"/\",\n        colors.magenta(this.summary.total), \"file(s)\"\n      )\n    } else {\n      log(\n        colors.yellow(\"No input files for schema validation\")\n      );\n    }\n  }\n\n  checkAllPassed() {\n    if (!this.options.emitError) return;\n\n    if (this.summary.invalid > 0) {\n      throw new Error(`There was schema validation error`);\n    }\n  }\n\n  addResultToSummary(file, result) {\n    this.summary.total++;\n    if (this.isValidResult(result)) {\n      this.summary.valid++;\n    } else {\n      this.summary.invalid++;\n    }\n    if (result.errors) {\n      this.summary.errors += result.errors.length;\n    }\n    if (result.missing) {\n      this.summary.missing += result.missing.length;\n    }\n  }\n\n  isValidResult(result) {\n    return result.valid &&\n      (this.options.missing !== \"error\" || result.missing.length === 0);\n  }\n\n  reportValid(file) {\n    if (!this.options.verbose) return;\n    log(\n      colors.green(figures.tick),\n      colors.cyan(file.relative)\n    );\n  }\n\n  reportMissingsWarning(file, missingCount) {\n    log(\n      colors.yellow(figures.warning),\n      colors.cyan(file.relative),\n      \"has\",\n      colors.yellow(`${missingCount} missing schema(s)`)\n    );\n  }\n\n  reportFailed(file, errorCount, missingCount) {\n    const results = [];\n    if (errorCount > 0) {\n      results.push(colors.red(`${errorCount} validation error(s)`));\n    }\n    if (missingCount > 0) {\n      results.push(colors.red(`${missingCount} missing schema(s)`));\n    }\n\n    log(\n      colors.red(figures.cross),\n      colors.cyan(file.relative),\n      results.length > 0 ? `has ${results.join(\" and \")}` : \"\"\n    );\n  }\n\n  reportErrors(errors) {\n    errors.forEach(err => {\n      this.reportError(err);\n    });\n  }\n\n  reportError(error, indent = \"  \") {\n    log(\n      indent,\n      colors.red(`${figures.pointerSmall} Error:`),\n      error.message || \"No error message provided by tv4\"\n    );\n    log(\n      indent,\n      colors.gray(\n        \"  at\",\n        colors.blue(error.dataPath || \"/\"),\n        \"against schema\",\n        colors.blue(error.schemaPath || \"/\")\n      )\n    );\n    if (error.subErrors) {\n      error.subErrors.forEach(err => {\n        this.reportError(err, `${indent}  `);\n      });\n    }\n  }\n\n  reportMissing(missings, warning, indent = \"  \") {\n    missings.forEach(uri => {\n      log(\n        indent,\n        warning ?\n          colors.yellow(`${figures.pointerSmall} Missing:`) :\n          colors.red(`${figures.pointerSmall} Missing:`),\n        uri\n      );\n    });\n  }\n}\n"]}